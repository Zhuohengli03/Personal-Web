---
import BaseLayout from '../../layouts/BaseLayout.astro';
import fs from 'fs';
import path from 'path';

const base = import.meta.env.BASE_URL;
const photoUrl = (filename: string) => `${base}photography/${filename}`;

// 构建时自动扫描 public/photography/，只保留图片文件，按文件名排序
const imageExtensions = new Set(['.jpg', '.jpeg', '.png', '.webp', '.gif']);
const photographyDir = path.join(process.cwd(), 'public', 'photography');
let photographyImages: string[] = [];
try {
  const files = fs.readdirSync(photographyDir);
  photographyImages = files
    .filter((f) => {
      const ext = path.extname(f).toLowerCase();
      return imageExtensions.has(ext) && !f.startsWith('.');
    })
    .sort();
} catch {
  // 目录不存在或无法读取时保持空数组
}
---
<BaseLayout title="Photography | Zhuoheng Li" description="Photography portfolio">
  <h1 class="page-title">Photography</h1>
  <p class="page-intro">A responsive grid; add lightbox later if needed.</p>

  <div class="photo-grid" aria-label="Photo gallery">
    {photographyImages.map((filename) => (
      <div class="photo-grid-item">
        <img
          src={photoUrl(filename)}
          alt=""
          width="400"
          height="300"
          loading="lazy"
          decoding="async"
        />
      </div>
    ))}
  </div>

  <p class="page-footer"><a href={base}>← Home</a></p>
</BaseLayout>

<style>
  .page-title {
    font-family: var(--font-serif);
    font-size: 1.5rem;
    font-weight: 600;
    margin: 0 0 0.5rem;
  }
  .page-intro {
    color: var(--muted);
    font-size: 0.95rem;
    margin: 0 0 1.5rem;
  }
  .photo-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .photo-grid-item {
    aspect-ratio: 4 / 3;
    border-radius: var(--radius);
    overflow: hidden;
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
  }
  .photo-grid-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  .page-footer {
    margin-top: 2rem;
    font-size: 0.9rem;
    color: var(--muted);
  }
</style>
